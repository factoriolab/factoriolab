<div class="label">Preset</div>
<div class="field">
  <select
    title="Select preset settings"
    [ngModel]="settings.preset"
    (change)="emitNumber(setPreset, $event)"
  >
    <option
      label="Minimum"
      title="Minimum belt and assembler, and no modules or beacons"
      [value]="Preset.Minimum"
    ></option>
    <option
      label="Modules"
      title="Best belt and assembler with modules in factories, but no beacons"
      [value]="Preset.Modules"
    ></option>
    <option
      label="8 Beacons"
      title="Best belt and assembler with modules in factories and 8 beacons per factory"
      [value]="Preset.Beacon16"
    ></option>
    <option
      label="12 Beacons"
      title="Best belt and assembler with modules in factories and 12 beacons per factory"
      [value]="Preset.Beacon24"
    ></option>
  </select>
</div>
<div class="label">Recipes</div>
<div class="field">
  <select
    title="Select base game version"
    [ngModel]="settings.baseId"
    (change)="setBase.emit($event.target.value)"
  >
    <option *ngFor="let b of base" [value]="b.id" [label]="b.name"></option>
  </select>
  <div>Recipe Set</div>
</div>
<div class="field" *ngIf="mods.length">
  <button #btnMods (click)="openSelect = OpenSelect.Mods">
    {{ settings.modIds.length }} Mod Set{{
      settings.modIds.length === 1 ? '' : 's'
    }}
    Enabled
  </button>
  <lab-multiselect
    *ngIf="openSelect === OpenSelect.Mods"
    [header]="'Select Mod Sets'"
    [enabledIds]="settings.modIds"
    [options]="mods"
    [parent]="btnMods"
    (cancel)="openSelect = OpenSelect.None"
    (enableId)="enableMod.emit({ id: $event, default: data.defaults.modIds })"
    (disableId)="disableMod.emit({ id: $event, default: data.defaults.modIds })"
  ></lab-multiselect>
</div>
<div class="field">
  <button #btnRecipes (click)="openSelect = OpenSelect.DisabledRecipes">
    {{ settings.disabledRecipes.length }} Recipe{{
      settings.disabledRecipes.length === 1 ? '' : 's'
    }}
    Disabled
  </button>
  <lab-toggle
    *ngIf="openSelect === OpenSelect.DisabledRecipes"
    [data]="data"
    [disabledRecipes]="settings.disabledRecipes"
    [default]="data.defaults.disabledRecipes"
    [parent]="btnRecipes"
    (cancel)="openSelect = OpenSelect.None"
    (enableRecipe)="enableRecipe.emit($event)"
    (disableRecipe)="disableRecipe.emit($event)"
  >
  </lab-toggle>
</div>
<div class="field">
  <div class="flex option" (click)="setExpensive.emit(!settings.expensive)">
    <div
      id="settings-expensive"
      title="Use expensive recipes"
      class="material-icons"
    >
      {{ settings.expensive ? 'check_box' : 'check_box_outline_blank' }}
    </div>
    <label for="settings-expensive" title="Use expensive recipes"
      >Expensive</label
    >
  </div>
</div>
<div class="label">Factory</div>
<div class="field">
  <lab-icon
    #btnFactory
    class="clickable"
    tooltip="Factory preferences"
    [iconId]="
      settings.factoryRank.length
        ? settings.factoryRank[0]
        : 'assembling-machine-1'
    "
    [data]="data"
    (click)="openSelect = OpenSelect.Factory"
  ></lab-icon>
  <lab-ranker
    *ngIf="openSelect === OpenSelect.Factory"
    [data]="data"
    [rank]="settings.factoryRank"
    [options]="data.factoryIds"
    [default]="data.defaults.factoryRank"
    [parent]="btnFactory.element"
    (cancel)="openSelect = OpenSelect.None"
    (preferItem)="preferFactory.emit($event)"
    (dropItem)="dropFactory.emit($event)"
  >
  </lab-ranker>
  <lab-icon
    #btnModule
    class="clickable"
    tooltip="Module preferences"
    [iconId]="settings.moduleRank.length ? settings.moduleRank[0] : MODULE_ID"
    [data]="data"
    (click)="openSelect = OpenSelect.Module"
  ></lab-icon>
  <lab-ranker
    *ngIf="openSelect === OpenSelect.Module"
    [data]="data"
    [rank]="settings.moduleRank"
    [options]="data.moduleIds"
    [default]="data.defaults.moduleRank"
    [parent]="btnModule.element"
    (cancel)="openSelect = OpenSelect.None"
    (preferItem)="preferModule.emit($event)"
    (dropItem)="dropModule.emit($event)"
  >
  </lab-ranker>
  <div
    class="flex clickable static"
    (click)="setDrillModule.emit(!settings.drillModule)"
  >
    <lab-icon
      iconId="electric-mining-drill"
      [data]="data"
      tooltip="Toggle drill modules"
      [scale]="true"
    ></lab-icon>
    <lab-icon
      [iconId]="settings.drillModule ? 'speed-module-3' : MODULE_ID"
      [data]="data"
      tooltip="Toggle drill modules"
    ></lab-icon>
  </div>
</div>
<div *ngIf="data.beaconIds.length" class="field">
  <lab-icon
    *ngIf="data.beaconIds.length === 1"
    class="clickable-size"
    [iconId]="settings.beacon"
    [data]="data"
  ></lab-icon>
  <lab-icon
    #btnBeacon
    class="clickable"
    [class.hidden]="data.beaconIds.length === 0"
    tooltip="Choose default beacon"
    [iconId]="settings.beacon"
    [data]="data"
    (click)="openSelect = OpenSelect.Beacon"
  ></lab-icon>
  <lab-select
    *ngIf="openSelect === OpenSelect.Beacon"
    [data]="data"
    [selectedId]="settings.beacon"
    [options]="data.beaconIds"
    [data]="data"
    [parent]="btnBeacon.element"
    (cancel)="openSelect = OpenSelect.None"
    (selectId)="
      setBeacon.emit({ value: $event, default: data.defaults.beacon })
    "
  >
  </lab-select>
  <lab-icon
    #btnBeaconModule
    class="clickable"
    tooltip="Beacon module"
    [iconId]="settings.beaconModule"
    [data]="data"
    (click)="openSelect = OpenSelect.BeaconModule"
  ></lab-icon>
  <lab-select
    *ngIf="openSelect === OpenSelect.BeaconModule"
    [data]="data"
    [selectedId]="settings.beaconModule"
    [options]="data.beaconModuleIds"
    [parent]="btnBeaconModule.element"
    includeEmptyModule="true"
    (cancel)="openSelect = OpenSelect.None"
    (selectId)="
      setBeaconModule.emit({
        value: $event,
        default: data.defaults.beaconModule
      })
    "
  >
  </lab-select>
  <input
    type="number"
    title="Enter default number of beacons"
    placeholder="# Beacons"
    min="0"
    step="1"
    [value]="settings.beaconCount"
    (change)="emitNumber(setBeaconCount, $event)"
  />
</div>
<div class="field">
  <lab-icon
    #btnBelt
    class="clickable"
    tooltip="Choose default belt"
    [iconId]="settings.belt"
    [data]="data"
    (click)="openSelect = OpenSelect.Belt"
  ></lab-icon>
  <lab-select
    *ngIf="openSelect === OpenSelect.Belt"
    [data]="data"
    [selectedId]="settings.belt"
    [options]="data.beltIds"
    [displayRate]="settings.displayRate"
    [data]="data"
    [parent]="btnBelt.element"
    (cancel)="openSelect = OpenSelect.None"
    (selectId)="setBelt.emit({ value: $event, default: data.defaults.belt })"
  >
  </lab-select>
  <lab-icon
    #btnFuel
    class="clickable"
    tooltip="Choose fuel"
    [iconId]="settings.fuel"
    [data]="data"
    (click)="openSelect = OpenSelect.Fuel"
  ></lab-icon>
  <lab-select
    *ngIf="openSelect === OpenSelect.Fuel"
    [data]="data"
    [options]="sortedFuels"
    [selectedId]="settings.fuel"
    [parent]="btnFuel.element"
    (cancel)="openSelect = OpenSelect.None"
    (selectId)="setFuel.emit({ value: $event, default: data.defaults.fuel })"
  >
  </lab-select>
</div>
<div class="field">
  <lab-icon iconId="pipe" tooltip="Pipe flow rate" [data]="data"></lab-icon>
  <input
    type="number"
    title="Enter pipe flow rate"
    placeholder="1500"
    min="0"
    step="1"
    [value]="settings.flowRate"
    (change)="emitNumber(setFlowRate, $event)"
  />
  <div>
    #/sec
    <a href="https://wiki.factorio.com/Fluid_system#Pipelines" target="_blank"
      >Wiki</a
    >
  </div>
</div>
<div class="label">Display Rate</div>
<div class="field">
  <div class="flex option">
    <input
      id="settings-display-persecond"
      title="Display rates per second"
      type="radio"
      name="displayRate"
      [value]="DisplayRate.PerSecond"
      [ngModel]="settings.displayRate"
      (change)="setDisplayRate.emit(DisplayRate.PerSecond)"
    />
    <label for="settings-display-persecond" title="Display rates per second"
      >#/sec</label
    >
  </div>
  <div class="flex option">
    <input
      id="settings-display-perminute"
      title="Display rates per minute"
      type="radio"
      name="displayRate"
      [value]="DisplayRate.PerMinute"
      [ngModel]="settings.displayRate"
      (change)="setDisplayRate.emit(DisplayRate.PerMinute)"
    />
    <label for="settings-display-perminute" title="Display rates per minute"
      >#/min</label
    >
  </div>
  <div class="flex option">
    <input
      id="settings-display-perhour"
      title="Display rates per hour"
      type="radio"
      name="displayRate"
      [value]="DisplayRate.PerHour"
      [ngModel]="settings.displayRate"
      (change)="setDisplayRate.emit(DisplayRate.PerHour)"
    />
    <label for="settings-display-perhour" title="Display rates per hour"
      >#/hr</label
    >
  </div>
</div>
<div class="label">Precision</div>
<div class="field">
  <lab-precision
    [data]="data"
    iconId="iron-plate"
    tooltip="Items precision"
    [value]="settings.itemPrecision"
    [default]="initial.itemPrecision"
    (setValue)="setItemPrecision.emit($event)"
  ></lab-precision>
</div>
<div class="field">
  <lab-precision
    [data]="data"
    iconId="transport-belt"
    tooltip="Belts precision"
    [value]="settings.beltPrecision"
    [default]="initial.beltPrecision"
    (setValue)="setBeltPrecision.emit($event)"
  ></lab-precision>
</div>
<div class="field">
  <lab-precision
    [data]="data"
    iconId="assembling-machine-1"
    tooltip="Factories precision"
    [value]="settings.factoryPrecision"
    [default]="initial.factoryPrecision"
    (setValue)="setFactoryPrecision.emit($event)"
  ></lab-precision>
</div>
<div class="field">
  <lab-precision
    [data]="data"
    iconId="substation"
    tooltip="Power precision"
    [value]="settings.powerPrecision"
    [default]="initial.powerPrecision"
    (setValue)="setPowerPrecision.emit($event)"
  ></lab-precision>
</div>
<div class="field">
  <lab-precision
    [data]="data"
    iconId="steam"
    tooltip="Pollution precision"
    [value]="settings.pollutionPrecision"
    [default]="initial.pollutionPrecision"
    (setValue)="setPollutionPrecision.emit($event)"
  ></lab-precision>
</div>
<div class="label">Bonuses</div>
<div class="field">
  <lab-icon
    iconId="electric-mining-drill"
    [data]="data"
    tooltip="Mining productivity bonus"
    [scale]="true"
  ></lab-icon>
  <div class="field">
    +
    <input
      type="number"
      title="Enter mining productivity bonus"
      placeholder="Mining productivity"
      min="0"
      step="10"
      [value]="settings.miningBonus"
      (change)="emitNumber(setMiningBonus, $event)"
    />
    %
  </div>
</div>
<div class="field">
  <lab-icon
    iconId="lab"
    [data]="data"
    tooltip="Research speed bonus"
    [scale]="true"
  ></lab-icon>
  <select
    title="Select research speed bonus level"
    [ngModel]="settings.researchSpeed"
    (change)="emitNumber(setResearchSpeed, $event)"
  >
    <option label="No Research Bonus" [value]="ResearchSpeed.Speed0"></option>
    <option label="Research Speed 1" [value]="ResearchSpeed.Speed1"></option>
    <option label="Research Speed 2" [value]="ResearchSpeed.Speed2"></option>
    <option label="Research Speed 3" [value]="ResearchSpeed.Speed3"></option>
    <option label="Research Speed 4" [value]="ResearchSpeed.Speed4"></option>
    <option label="Research Speed 5" [value]="ResearchSpeed.Speed5"></option>
    <option label="Research Speed 6" [value]="ResearchSpeed.Speed6"></option>
  </select>
</div>
<div class="label">Theme</div>
<div class="field">
  <select
    id="settings-theme-select"
    title="Choose color theme"
    [ngModel]="settings.theme"
    (change)="emitString(setTheme, $event)"
  >
    <option label="Dark Mode" [value]="Theme.DarkMode"></option>
    <option label="Light Mode" [value]="Theme.LightMode"></option>
  </select>
</div>
