<h2 class="mb-1 text-2xl font-light sm:mb-1.5 lg:mb-3">Objectives</h2>

<div class="mb-1 flex max-w-200 gap-1 sm:gap-2">
  <div class="invisible hidden min-w-9 sm:block"></div>
  <span class="min-w-9 md:hidden"></span>
  <span class="mx-1 hidden basis-2/5 text-sm text-gray-300 md:block">{{
    'objectives.target' | translate
  }}</span>
  <span class="mx-1 basis-1/3 text-sm text-gray-300 md:basis-1/5">{{
    'objectives.quantity' | translate
  }}</span>
  <span class="mx-1 basis-1/3 text-sm text-gray-300 md:basis-1/5">{{
    'objectives.units' | translate
  }}</span>
  <span class="mx-1 basis-1/3 text-sm text-gray-300 md:basis-1/5">{{
    'objectives.type' | translate
  }}</span>
  <div class="invisible min-w-9"></div>
</div>

<div
  class="flex flex-col gap-1 sm:gap-2"
  cdkDropList
  (cdkDropListDropped)="drop($event)"
>
  @for (objective of objectives(); track objective.id) {
    <div cdkDrag cdkDragLockAxis="y" cdkDragBoundary=".flex.flex-col">
      <div class="flex max-w-200 gap-1 bg-gray-950 sm:gap-2">
        <button
          class="sm:inline-flex"
          cdkDragHandle
          labButton
          [faIcon]="faGrip"
          [hide]="true"
          [attr.aria-label]="'objective.drag' | translate"
        ></button>
        <button
          type="button"
          class="md:hidden"
          labButton
          [iconType]="
            objective.unit === ObjectiveUnit.Machines ? 'recipe' : 'item'
          "
          [icon]="objective.targetId"
          [attr.aria-label]="
            (objective.unit === ObjectiveUnit.Machines
              ? data().recipeRecord
              : data().itemRecord)[objective.targetId].name
          "
          (click)="changeTarget(objective)"
        ></button>
        <button
          type="button"
          class="basis-2/5 md:inline-flex"
          labButton
          [iconType]="
            objective.unit === ObjectiveUnit.Machines ? 'recipe' : 'item'
          "
          [icon]="objective.targetId"
          [text]="
            (objective.unit === ObjectiveUnit.Machines
              ? data().recipeRecord
              : data().itemRecord)[objective.targetId].name
          "
          [hide]="true"
          (click)="changeTarget(objective)"
        ></button>
        <lab-input-number
          class="basis-1/3 md:basis-1/5"
          [ngModel]="objective.value"
          (ngModelChange)="
            objectivesStore.updateRecord(objective.id, { value: $event })
          "
        ></lab-input-number>
        <lab-select
          class="basis-1/3 md:basis-1/5"
          [ngModel]="objective.unit"
          [options]="unitOptions()"
          (ngModelChange)="conversion.changeUnit(objective, $event)"
        ></lab-select>
        <lab-select
          class="basis-1/3 md:basis-1/5"
          [ngModel]="objective.type"
          [options]="typeOptions"
          (ngModelChange)="
            objectivesStore.updateRecord(objective.id, { type: $event })
          "
        ></lab-select>
        <button
          type="button"
          labButton
          [faIcon]="faXmark"
          [attr.aria-label]="'objectives.removeTooltip' | translate"
          (click)="objectivesStore.remove(objective.id)"
        ></button>
      </div>
    </div>
  }
</div>

<div class="mt-1 flex max-w-200 gap-1 sm:mt-2 sm:gap-2">
  <div class="invisible hidden min-w-9 sm:block"></div>
  <button
    type="button"
    class="md:hidden"
    labButton
    [faIcon]="faPlus"
    color="brand"
    [attr.aria-label]="isRecipe() ? 'picker.selectRecipe' : 'picker.selectItem'"
    (click)="openPicker()"
  ></button>
  <button
    type="button"
    class="basis-2/5 md:inline-flex"
    labButton
    [faIcon]="faPlus"
    color="brand"
    [text]="isRecipe() ? 'picker.selectRecipe' : 'picker.selectItem'"
    [hide]="true"
    (click)="openPicker()"
  ></button>
  <lab-input-number
    class="basis-1/3 md:basis-1/5"
    [(ngModel)]="value"
  ></lab-input-number>
  <lab-select
    class="basis-1/3 md:basis-1/5"
    [(ngModel)]="unit"
    [options]="unitOptions()"
  ></lab-select>
  <lab-select
    class="basis-1/3 md:basis-1/5"
    [(ngModel)]="type"
    [options]="typeOptions"
  ></lab-select>
  <div class="invisible min-w-9"></div>
</div>
